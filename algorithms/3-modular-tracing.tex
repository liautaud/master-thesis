\begin{figure}[!ht]
  \caption{Modular tracing collection.}
  \label{alg:modular-tracing}

  \vspace{-.5em}
  \centering
  \begin{lstlisting}
atomic Collect():
    marked $\leftarrow$ mark()
    backend.heap.Filter(Î»h. h $\in$ marked)

mark():
    marked $\leftarrow$ $\emptyset$           # Set of all the black objects.
    pending $\leftarrow$ Roots()   # Stack of all the grey objects.

    while pending $\neq$ $\emptyset$:
        o $\leftarrow$ pop(pending)
        if hash(o) $\not\in$ marked:
            marked $\leftarrow$ marked $\cup$ {hash(o)}
            pending $\leftarrow$ pending $\cup$ successors(o)

    return marked
\end{lstlisting}
\end{figure}
